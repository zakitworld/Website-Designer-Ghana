@page "/admin/contact-submissions"
@using Microsoft.AspNetCore.Authorization
@using Website_Designer_Ghana.Services.Interfaces
@using Website_Designer_Ghana.Data.Models
@attribute [Authorize(Roles = "Admin")]
@layout AdminLayout
@rendermode InteractiveServer

<PageTitle>Contact Submissions - Admin</PageTitle>

<div class="contact-submissions-admin pt-3">
    <div class="row mb-5">
        <div class="col">
            <h2 class="display-6 fw-bold gradient-text mb-1">Contact Submissions</h2>
            <p class="text-muted mb-0">Monitor and respond to client inquiries promptly.</p>
        </div>
    </div>

    <div class="glass-card border-0 shadow-lg overflow-hidden">
        <div class="p-0">
            @if (submissions == null)
            {
                <div class="text-center py-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
            }
            else if (!submissions.Any())
            {
                <div class="text-center py-5">
                    <i class="bi bi-chat-left-dots fs-1 text-muted mb-3 d-block"></i>
                    <p class="text-muted mb-0">No contact submissions yet.</p>
                </div>
            }
            else
            {
                <div class="table-responsive">
                    <table class="table table-dark table-hover align-middle mb-0">
                        <thead class="bg-white bg-opacity-05">
                            <tr>
                                <th class="px-4 py-3 text-muted fw-semibold border-opacity-10">Client</th>
                                <th class="py-3 text-muted fw-semibold border-opacity-10">Subject</th>
                                <th class="py-3 text-muted fw-semibold border-opacity-10">Phone</th>
                                <th class="py-3 text-muted fw-semibold border-opacity-10">Status</th>
                                <th class="py-3 text-muted fw-semibold border-opacity-10">Submitted</th>
                                <th class="px-4 py-3 text-muted fw-semibold border-opacity-10 text-end">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var submission in submissions)
                            {
                                <tr class="@(submission.IsRead ? "opacity-75" : "fw-bold")">
                                    <td class="px-4 py-3">
                                        <div class="text-white">@submission.FullName</div>
                                        <small class="text-secondary">@submission.Email</small>
                                    </td>
                                    <td>
                                        <span class="text-white opacity-75">@submission.Subject</span>
                                    </td>
                                    <td class="text-muted">@(submission.Phone ?? "N/A")</td>
                                    <td>
                                        @if (submission.IsRead)
                                        {
                                            <span class="badge bg-opacity-10 bg-success text-success rounded-pill px-3">
                                                <i class="bi bi-check2-all me-1"></i> Read
                                            </span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-opacity-10 bg-warning text-warning rounded-pill px-3">
                                                <i class="bi bi-envelope-exclamation me-1"></i> New
                                            </span>
                                        }
                                    </td>
                                    <td class="text-muted small">@submission.SubmittedAt.ToString("MMM dd, HH:mm")</td>
                                    <td class="px-4 text-end">
                                        <button type="button"
                                            class="btn btn-outline-primary btn-sm border-opacity-10 px-3 shadow-sm ripple-effect"
                                        @onclick="() => ViewSubmission(submission)">
                                            <i class="bi bi-eye me-1"></i> Details
                                        </button>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
        </div>
    </div>
</div>


<!-- View Modal -->
@if (selectedSubmission != null)
{
    <div class="modal fade show d-block" tabindex="-1" style="background: rgba(0,0,0,0.8); backdrop-filter: blur(8px);">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="glass-card border-0 shadow-2xl w-100 overflow-hidden">
                <div
                    class="p-4 border-bottom border-white border-opacity-10 d-flex justify-content-between align-items-center">
                    <h5 class="modal-title fw-bold text-white mb-0">
                        <i class="bi bi-envelope-open text-primary me-2"></i>
                        Submission Details
                    </h5>
                    <button type="button" class="btn-close btn-close-white opacity-50" @onclick="CloseModal"></button>
                </div>
                <div class="p-4">
                    <div class="row g-4">
                        <div class="col-md-6">
                            <label class="text-secondary small text-uppercase fw-bold ls-wide mb-1 d-block">Full
                                Name</label>
                            <div class="text-white fw-bold fs-5">@selectedSubmission.FullName</div>
                        </div>
                        <div class="col-md-6">
                            <label class="text-secondary small text-uppercase fw-bold ls-wide mb-1 d-block">Email
                                Address</label>
                            <div class="text-white"><a href="mailto:@selectedSubmission.Email"
                                    class="text-primary text-decoration-none">@selectedSubmission.Email</a></div>
                        </div>
                        <div class="col-md-6">
                            <label class="text-secondary small text-uppercase fw-bold ls-wide mb-1 d-block">Phone
                                Number</label>
                            <div class="text-white">@(selectedSubmission.Phone ?? "Not provided")</div>
                        </div>
                        <div class="col-md-6">
                            <label class="text-secondary small text-uppercase fw-bold ls-wide mb-1 d-block">Subject /
                                Interest</label>
                            <div class="text-white">@selectedSubmission.Subject</div>
                        </div>
                        @if (!string.IsNullOrEmpty(selectedSubmission.Company))
                        {
                            <div class="col-md-6">
                                <label class="text-secondary small text-uppercase fw-bold ls-wide mb-1 d-block">Company</label>
                                <div class="text-white">@selectedSubmission.Company</div>
                            </div>
                        }
                        <div class="col-12 border-top border-white border-opacity-10 pt-4">
                            <label class="text-secondary small text-uppercase fw-bold ls-wide mb-2 d-block">Message
                                Content</label>
                            <div class="bg-black bg-opacity-50 p-4 rounded border border-white border-opacity-10 text-white-50 lh-lg"
                                style="white-space: pre-wrap;">@selectedSubmission.Message</div>
                        </div>
                        <div class="col-md-6 border-top border-white border-opacity-10 pt-4">
                            <label class="text-secondary small text-uppercase fw-bold ls-wide mb-1 d-block">Submitted
                                On</label>
                            <div class="text-muted">@selectedSubmission.SubmittedAt.ToString("MMMM dd, yyyy 'at' HH:mm")
                            </div>
                        </div>
                        <div class="col-md-6 border-top border-white border-opacity-10 pt-4">
                            <label class="text-secondary small text-uppercase fw-bold ls-wide mb-1 d-block">IP
                                Context</label>
                            <div class="text-muted small">@(selectedSubmission.IpAddress ?? "Unknown")</div>
                        </div>
                    </div>
                </div>
                <div
                    class="p-4 bg-black bg-opacity-50 border-top border-white border-opacity-10 d-flex justify-content-end">
                    <button type="button" class="btn btn-outline-light border-opacity-10 px-4"
                    @onclick="CloseModal">Close</button>
                    <a href="mailto:@selectedSubmission.Email" class="btn btn-primary px-4 border-0 shadow-lg ms-2">
                        <i class="bi bi-reply-fill me-2"></i>Reply via Email
                    </a>
                </div>
            </div>
        </div>
    </div>
}

